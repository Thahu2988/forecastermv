<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Maldives Weather Forecast Board (Full Editor & Post)</title>

<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

<style>
    /* --- Base layout and fonts --- */
    body {
        font-family: Arial, sans-serif;
        background-color: #eef3f7;
        margin: 0;
        padding: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
    }
    
    /* ========================================
    *** FONT DEFINITIONS (Adjust paths if necessary) ***
    ======================================== */
    @font-face {
        font-family: 'Faruma';
        src: url('Faruma.ttf') format('truetype');
        font-weight: normal;
    }
    @font-face {
        font-family: 'Mvlhohi-Bold';
        src: url('Mvlhohi bold.ttf') format('truetype');
        font-weight: bold;
    }

    /* --- EDITOR STYLES --- */
    .editor-container {
        width: 100%;
        max-width: 800px; 
        background: #ffffff;
        padding: 20px 25px;
        border-radius: 12px;
        box-shadow: 0 4px 14px rgba(0,0,0,0.1);
        margin-bottom: 25px;
        border-top: 5px solid #004d99;
    }
    .editor-container h2 {
        margin-top: 0;
        color: #004d99;
    }
    
    .datetime-group { display: flex; gap: 20px; margin-bottom: 10px; }
    .datetime-group .input-item { flex: 1; }
    
    label { display: block; font-weight: bold; color: #004d99; margin-bottom: 4px; }
    textarea, input[type="date"], select { width: 100%; padding: 8px; border-radius: 6px; border: 1px solid #ccc; font-size: 14px; box-sizing: border-box; }
    textarea { height: 50px; resize: vertical; }
    
    button { background-color: #004d99; color: white; border: none; border-radius: 6px; padding: 10px 16px; font-size: 15px; cursor: pointer; margin-top: 8px; width: 49%; box-sizing: border-box; }
    button:nth-child(even) { margin-left: 1%; }
    button:hover { background-color: #0066cc; }

    /* --- POST PREVIEW STYLES --- */
    .weather-post-container {
        width: 100%;
        max-width: 800px; 
        background-color: #ffffff; 
        box-shadow: 0 4px 14px rgba(0,0,0,0.1);
        border-radius: 12px;
        padding: 20px 0; 
        display: flex;
        flex-direction: row; 
        gap: 15px; 
        align-items: stretch; 
        overflow: hidden;
    }

    /* --- Map area --- */
    .map-area {
        flex: 0.8; 
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 0; 
        background-color: #ffffff; 
    }
    .map-area img {
        width: 100%; 
        max-width: 100%; 
        height: 100%; 
        object-fit: contain; 
        border-radius: 0;
        box-shadow: none;
        padding-left: 10px; 
    }

    /* --- Content area (Right side) --- */
    .post-content-area {
        flex: 2.2; 
        background-color: #ffffff;
        border-radius: 10px;
        padding: 0; 
        display: flex;
        flex-direction: column; 
        min-height: 450px; 
    }

    /* --- Advisory section (Base style for the warning box - Default/English fallback) --- */
    .advisory-section {
        background-color: #fffde7; 
        border: 1px solid #ffd700;
        border-left: 5px solid #ff9800; 
        border-radius: 4px;
        /* Tightened vertical margin for sections */
        margin: 5px 0 5px 0; 
        padding: 10px 15px;
        display: none; 
    }
    
    /* TARGETED RED ADVISORY STYLING */
    .red-advisory-style {
        background-color: #b30000; 
        border: 1px solid #ff0000; 
        border-left: 5px solid #ff3333; 
    }
    .red-advisory-style .advisory-dv p, 
    .red-advisory-style .advisory-dv span,
    .red-advisory-style .advisory-en p, 
    .red-advisory-style .advisory-en span {
        color: white !important; 
    }
    
    /* Container for the single-line advisory content */
    .advisory-en p, .advisory-dv p {
        font-size: 0.95em;
        margin: 3px 0;
        line-height: 1.4em;
        display: block; 
        width: 100%;
    }
    
    .advisory-en p {
        text-align: left;
    }

    .advisory-dv p {
        direction: rtl;
        text-align: right;
        font-family: 'Faruma', Arial, sans-serif;
    }

    /* ========================================
    *** FORECAST SECTIONS (Dhivehi over English) ***
    ======================================== */
    .bilingual-vertical-sections {
        flex: 1; 
        display: flex;
        flex-direction: column; 
        padding: 0 15px 0 25px; 
        padding-top: 20px; 
    }
    
    .section-top-header {
        text-align: center;
        padding: 5px 0; 
        /* Reduced margin-bottom */
        margin-bottom: 0px; 
        border-radius: 8px 0 0 0;
    }

    /* Header colors are kept as dark blue on light blue/white */
    .dhivehi-block-header {
        border-bottom: 4px solid #004d99; 
        background-color: #e0f2f7; 
        /* Ensure no extra space at the top */
        margin-top: 0;
    }

    .english-block-header {
        border-bottom: 4px solid #004d99;
        background-color: #e0f2f7; 
        /* Reduced top margin to pull it up closer to the Dhivehi content */
        margin-top: 5px; 
    }

    .dhivehi-header-title {
        font-size: 1.7em;
        color: #004d99; 
        margin: 0; 
        direction: rtl;
        font-family: 'Faruma', Arial, sans-serif; 
    }

    .english-header-title {
        font-size: 1.5em;
        color: #004d99;
        font-weight: bold;
        margin: 0; 
        letter-spacing: 1px;
    }
    
    .dhivehi-header-date {
        font-size: 1.05em;
        font-weight: bold;
        color: #333;
        margin-top: 0; 
        direction: rtl;
        font-family: 'Faruma', Arial, sans-serif; 
    }
    
    .english-header-date {
        font-size: 1.05em;
        font-weight: bold;
        color: #333;
        margin-top: 0; 
    }
    
    /* --- Forecast Item Styling (Single Line Format) --- */
    .forecast-item {
        margin-bottom: 6px; /* Slightly reduced spacing between items */
    }
    
    /* Style for the paragraph containing the combined heading and content */
    .forecast-line {
        font-size: 0.95em;
        line-height: 1.4;
        margin: 0; 
    }
    
    /* English text defaults to LTR and Arial */
    .english-section .forecast-line {
        text-align: left;
    }

    /* Dhivehi text uses RTL and Faruma (for body text) */
    .dhivehi-section .forecast-line {
        text-align: right;
        direction: rtl;
        font-family: 'Faruma', Arial, sans-serif; 
    }

    /* English Section specific margin control */
    .english-section {
        /* Reduced top padding/margin to pull content closer to the English header */
        padding-top: 5px; 
    }
    
    /* ========================================
    *** FOOTER STYLES ***
    ======================================== */
    .footer {
        display: flex;
        align-items: center;
        justify-content: space-between; 
        padding: 10px 15px 10px 25px; 
        background-color: #e0f2f7;
        border-top: 1px solid #004d99;
        font-size: 13px; 
        margin-top: auto; 
        border-radius: 0 0 0 8px;
    }

    .footer-left {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .footer-left img.logo-50 {
        height: 35px; 
        width: auto;
    }

    .footer-left span {
        /* NEW: Reduced size and prevented wrap */
        font-weight: bold;
        color: #004d99;
        font-size: 12px; /* Reduced font size */
        white-space: nowrap; /* Forces text onto a single line */
    }

    .footer-center img {
        height: 28px;
        width: auto;
    }

    .footer-right {
        display: flex;
        align-items: center;
        gap: 10px;
        font-family: 'Faruma', Arial, sans-serif;
        color: #004d99; 
        white-space: nowrap;
        font-size: 13px; 
        padding-right: 0; 
    }

    .social-icons {
        display: flex;
        gap: 4px;
    }

    .social-icons svg {
        width: 18px;
        height: 18px;
        transition: transform 0.2s ease, opacity 0.2s ease;
        cursor: pointer;
    }

    .icon-link:hover svg {
        transform: scale(1.2);
        opacity: 0.8;
    }
</style>
</head>
<body onload="initializeEditor()">

<div class="editor-container">
    <h2>üìù Daily Forecast Editor</h2>
    
    <div class="datetime-group">
        <div class="input-item">
            <label for="date-input">Date</label>
            <input type="date" id="date-input" value="2025-10-31" onchange="updatePost()">
        </div>
        <div class="input-item">
            <label for="time-select">Valid Until Time (hrs)</label>
            <select id="time-select" onchange="updatePost()">
            </select>
        </div>
        <div class="input-item">
            <label for="forecast-period">Forecast Period</label>
            <select id="forecast-period" onchange="updatePost()">
                <option value="today">Today's Weather</option>
                <option value="tonight">Tonight's Weather</option>
            </select>
        </div>
    </div>
    
    <div class="input-group">
        <label for="adv-en">‚ö†Ô∏è Advisory (English)</label>
        <textarea id="adv-en" oninput="updatePost()">All are advised to be cautious.</textarea>
    </div>
    <div class="input-group">
        <label for="adv-dv">üö® Advisory (Dhivehi)</label>
        <textarea id="adv-dv" oninput="updatePost()">ﬁÄﬁ™ﬁÉﬁ®ﬁÄﬁß ﬁäﬁ¶ﬁÉﬁßﬁåﬁ∞ﬁåﬁ¶ﬁÜﬁ™ﬁÇﬁ∞ﬁàﬁ¨ﬁêﬁ∞ ﬁêﬁ¶ﬁâﬁßﬁçﬁ™ﬁàﬁ™ﬁÇﬁ∞ ﬁáﬁ¨ﬁãﬁ¨ﬁâﬁ¨ﬁàﬁ¨.</textarea>
    </div>

    <div class="input-group">
        <label for="wx-en">Weather (English)</label>
        <textarea id="wx-en" oninput="updatePost()">Scattered showers with a few thunderstorms are expected over the country.</textarea>
    </div>
    <div class="input-group">
        <label for="wx-dv">Weather (Dhivehi)</label>
        <textarea id="wx-dv" oninput="updatePost()">ﬁâﬁ™ﬁÖﬁ® ﬁÉﬁßﬁáﬁ∞ﬁñﬁ¨ﬁáﬁ¶ﬁÅﬁ∞ ﬁàﬁ®ﬁáﬁ∞ﬁêﬁßﬁÉﬁ¶ﬁÜﬁ™ﬁÉﬁ™ﬁÇﬁ∞ ﬁáﬁ¨ﬁÜﬁ¶ﬁÅﬁ©ﬁéﬁ¨ﬁÇﬁ∞ﬁàﬁ≠.</textarea>
    </div>
    <div class="input-group">
        <label for="wind-en">Wind (English)</label>
        <textarea id="wind-en" oninput="updatePost()">Winds W to NW at 10 - 20 knots, gusting 45 knots during showers.</textarea>
    </div>
    <div class="input-group">
        <label for="wind-dv">Wind (Dhivehi)</label>
        <textarea id="wind-dv" oninput="updatePost()">ﬁàﬁ¶ﬁáﬁ® ﬁñﬁ¨ﬁÄﬁ≠ﬁÇﬁ¨ ﬁéﬁÆﬁåﬁ∞: ﬁÄﬁ™ﬁÖﬁ¶ﬁÇﬁéﬁ™-ﬁáﬁ™ﬁåﬁ™ﬁÉﬁ™ﬁÇﬁ∞ 10-20 ﬁÇﬁÆﬁìﬁ¶ﬁÅﬁ∞ÿå ﬁàﬁ®ﬁáﬁ∞ﬁêﬁßﬁÉﬁßﬁéﬁ¶ﬁáﬁ® 45 ﬁÇﬁÆﬁìﬁ¶ﬁÅﬁ∞ ﬁÑﬁßﬁÉﬁ™ﬁàﬁßﬁÇﬁ¨.</textarea>
    </div>
    <div class="input-group">
        <label for="sea-en">Sea (English)</label>
        <textarea id="sea-en" oninput="updatePost()">Sea: Generally rough in southern atolls and moderate becoming rough during showers elsewhere.</textarea>
    </div>
    <div class="input-group">
        <label for="sea-dv">Sea (Dhivehi)</label>
        <textarea id="sea-dv" oninput="updatePost()">ﬁÜﬁ¶ﬁÇﬁëﬁ™: ﬁãﬁ¨ﬁÜﬁ™ﬁÇﬁ™ﬁéﬁ¨ ﬁáﬁ¶ﬁåﬁÆﬁÖﬁ™ﬁåﬁ¶ﬁÜﬁ¶ﬁÅﬁ∞ ﬁáﬁßﬁãﬁ¶ﬁáﬁ®ﬁéﬁ¨ ﬁàﬁ¶ﬁÉﬁ¶ﬁÜﬁ¶ﬁÅﬁ∞ÿå ﬁáﬁ¨ﬁÄﬁ¨ﬁÇﬁ∞ ﬁÄﬁ®ﬁêﬁßﬁÑﬁ™ﬁåﬁ¶ﬁÜﬁ¶ﬁÅﬁ∞ ﬁéﬁ¶ﬁãﬁ¶ﬁàﬁßﬁÇﬁ¨.</textarea>
    </div>
    <div class="input-group">
        <label for="wave-en">Wave Height (English)</label>
        <textarea id="wave-en" oninput="updatePost()">Wave height: 4‚Äì7 feet.</textarea>
    </div>
    <div class="input-group">
        <label for="wave-dv">Wave Height (Dhivehi)</label>
        <textarea id="wave-dv" oninput="updatePost()">ﬁÉﬁßﬁÖﬁ™ﬁéﬁ¨ ﬁáﬁ™ﬁêﬁ∞ﬁâﬁ®ﬁÇﬁ∞: 4-7 ﬁäﬁ´ﬁìﬁ™.</textarea>
    </div>

    <button onclick="updatePost()">üîÑ Update Preview</button>
    <button onclick="downloadPost()">‚¨áÔ∏è Download Image</button>
</div>

<div class="weather-post-container" id="weather-post">
    <div class="map-area">
        <img src="maldives_map.png" alt="Maldives Map">
    </div>

    <div class="post-content-area">

        <div class="bilingual-vertical-sections">
            
            <div class="section-top-header dhivehi-block-header">
                <h2 class="dhivehi-header-title" id="dv-header-title"></h2>
                <p class="dhivehi-header-date" id="dv-header-date"></p>
            </div>
            
            <div class="advisory-section red-advisory-style" id="adv-dv-section">
                <div class="advisory-dv" id="adv-dv-container"></div>
            </div>

            <div class="dhivehi-section">
                <div class="forecast-item" id="wx-dv-container"></div>
                <div class="forecast-item" id="wind-dv-container"></div>
                <div class="forecast-item" id="sea-dv-container"></div>
                <div class="forecast-item" id="wave-dv-container"></div>
            </div>
            
            <div class="section-top-header english-block-header">
                <h2 class="english-header-title" id="en-header-title"></h2>
                <p class="english-header-date" id="en-header-date"></p>
            </div>

            <div class="advisory-section red-advisory-style" id="adv-en-section">
                <div class="advisory-en" id="adv-en-container"></div>
            </div>

            <div class="english-section">
                <div class="forecast-item" id="wx-en-container"></div>
                <div class="forecast-item" id="wind-en-container"></div>
                <div class="forecast-item" id="sea-en-container"></div>
                <div class="forecast-item" id="wave-en-container"></div>
            </div>

        </div>

        <footer class="footer">
            <div class="footer-left">
                <img src="maldives_logo.png" alt="50 Years Logo" class="logo-50">
                <span>Maldives Meteorological Service</span>
            </div>

            <div class="footer-center">
                <img src="emblem.png" alt="Maldives Emblem">
            </div>

            <div class="footer-right">
                ﬁâﬁØﬁçﬁ∞ﬁëﬁ®ﬁàﬁ∞ﬁêﬁ∞ ﬁâﬁ©ﬁìﬁ®ﬁáﬁÆﬁÉﬁÆﬁçﬁÆﬁñﬁ®ﬁÜﬁ¶ﬁçﬁ∞ ﬁêﬁ¶ﬁÉﬁàﬁ®ﬁêﬁ∞
                <div class="social-icons">
                    <a href="https://www.viber.com" target="_blank" class="icon-link" title="Viber">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 240 240">
                            <rect width="240" height="240" rx="48" ry="48" fill="#7360f2"/>
                            <path fill="#fff" d="M168 155c-7-7-43-31-50-35s-11-5-18 2-21 26-27 31-10 7-18 3-36-14-68-43S-47 71-53 63-55 49-49 44s14-13 20-19 2-12-2-18S-61-5-67-12s-9-7-15-7-14 0-22 11S-133 5-133 40s33 75 38 80 64 95 153 134c55 25 78 27 95 24s47-21 53-33 6-20 6-23-2-3-8-10z" transform="translate(132 60) scale(0.55)"/>
                            <path fill="#fff" d="M141.7 86.2c-2.5 0-4.5 2-4.5 4.5s2 4.5 4.5 4.5c12.9 0 23.4 10.5 23.4 23.4 0 2.5 2 4.5 4.5 4.5s4.5-2 4.5-4.5c.1-17.8-14.5-32.4-32.4-32.4zm.6-22.7c-2.5 0-4.5 2-4.5 4.5s2 4.5 4.5 4.5c25.5 0 46.3 20.8 46.3 46.3 0 2.5 2 4.5 4.5 4.5s4.5-2 4.5-4.5c0-30.5-24.8-55.3-55.3-55.3zm-3.3-22.5c-2.5 0-4.5 2-4.5 4.5s2 4.5 4.5 4.5c37.8 0 68.6 30.8 68.6 68.6 0 2.5 2 4.5 4.5 4.5s4.5-2 4.5-4.5c.1-42.7-34.8-77.6-77.6-77.6z"/>
                        </svg>
                    </a>

                    <a href="https://x.com/" target="_blank" class="icon-link" title="X (Twitter)">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path fill="#000000" d="M18.244 2.25h3.308l-7.227 8.26L22 21.75h-5.956l-4.67-6.104L6.06 21.75H2.75l7.73-8.839L2 2.25h6.056l4.215 5.624L18.244 2.25zM17.208 19.59h1.833L7.08 4.33H5.12l12.088 15.26z"/>
                        </svg>
                    </a>

                    <a href="https://facebook.com/" target="_blank" class="icon-link" title="Facebook">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                            <path fill="#1877F2" d="M512 256C512 114.6 397.4 0 256 0S0 114.6 0 256c0 128.5 94.1 235.1 216 253.4V330h-65v-74h65v-56.4c0-64.4 38.3-100 96.8-100 28.1 0 57.6 5 57.6 5v63h-32.4c-31.9 0-41.9 19.8-41.9 40v48.4h71l-11.3 74h-59.7v179.4C417.9 491.1 512 384.5 512 256z"/>
                        </svg>
                    </a>
                </div>
            </div>
        </footer>
    </div>
</div>

<script>
    // Dhivehi Month Names (Standard)
    const dhivehiMonths = [
        "ﬁñﬁ¨ﬁÇﬁ™ﬁáﬁ¶ﬁÉﬁ©", "ﬁäﬁ¨ﬁÑﬁ™ﬁÉﬁ™ﬁáﬁ¶ﬁÉﬁ©", "ﬁâﬁßﬁÉﬁ®ﬁóﬁ™", "ﬁáﬁ¨ﬁïﬁ∞ﬁÉﬁ©ﬁçﬁ∞", "ﬁâﬁ≠", "ﬁñﬁ´ﬁÇﬁ∞",
        "ﬁñﬁ™ﬁçﬁ¶ﬁáﬁ®", "ﬁáﬁÆﬁéﬁ¶ﬁêﬁ∞ﬁìﬁ™", "ﬁêﬁ¨ﬁïﬁ∞ﬁìﬁ¨ﬁâﬁ∞ﬁÑﬁ¶ﬁÉﬁ™", "ﬁáﬁÆﬁÜﬁ∞ﬁìﬁØﬁÑﬁ¶ﬁÉﬁ™", "ﬁÇﬁÆﬁàﬁ¨ﬁâﬁ∞ﬁÑﬁ¶ﬁÉﬁ™", "ﬁëﬁ®ﬁêﬁ¨ﬁâﬁ∞ﬁÑﬁ¶ﬁÉﬁ™"
    ];

    // Helper function to get month name
    function getMonthName(monthIndex) {
        const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
        return months[monthIndex];
    }
    
    // Helper function to get Dhivehi month name
    function getDhivehiMonthName(monthIndex) {
        return dhivehiMonths[monthIndex];
    }

    // Helper function to add day suffix (st, nd, rd, th)
    function getDaySuffix(day) {
        if (day > 3 && day < 21) return 'th'; 
        switch (day % 10) {
            case 1:  return "st";
            case 2:  return "nd";
            case 3:  return "rd";
            default: return "th";
        }
    }
    
    // Helper function to update forecast item (used for all content now)
    function updateForecastItem(lang, id, heading, content) {
        const container = document.getElementById(`${id}-${lang}-container`);
        const contentText = content || document.getElementById(`${id}-${lang}`).value;
        const section = document.getElementById(`${id}-${lang}-section`); 
        
        // 1. Check if the advisory content is empty/whitespace only
        const isContentEmpty = contentText.trim() === '';
        
        // 2. Control visibility of the entire advisory section
        if (section) {
            section.style.display = isContentEmpty ? 'none' : 'block';
        }

        // 3. Update the inner content only if content is not empty
        let line = '';
        if (!isContentEmpty || id !== 'adv') { 
            // Only skip content update for empty advisory
            
            line = `<p class="forecast-line">`;
            
            if (lang === 'en') {
                // English: HEADING: CONTENT (LTR)
                let color = id === 'adv' ? 'white' : '#004d99'; 
                let headingText = id === 'adv' ? 'ADVISORY' : heading.toUpperCase();
                
                line += `<span style="font-weight: bold; color: ${color}; margin-right: 5px;">${headingText}:</span>${contentText}`;
            } else if (lang === 'dv') {
                // Dhivehi: CONTENT [SPACE] HEADING (RTL visual order)
                let color = id === 'adv' ? 'white' : '#004d99'; 
                let dvHeadingText;
                if (id === 'adv') dvHeadingText = 'ﬁáﬁ®ﬁÉﬁ™ﬁùﬁßﬁãﬁ™';
                else if (id === 'wx') dvHeadingText = 'ﬁâﬁ´ﬁêﬁ™ﬁÇﬁ∞';
                else if (id === 'wind') dvHeadingText = 'ﬁàﬁ¶ﬁáﬁ®';
                else if (id === 'sea') dvHeadingText = 'ﬁÜﬁ¶ﬁÇﬁëﬁ™ﬁéﬁ¨ ﬁôﬁßﬁçﬁ¶ﬁåﬁ™';
                else if (id === 'wave') dvHeadingText = 'ﬁÉﬁßﬁÖﬁ™ﬁéﬁ¨ ﬁáﬁ™ﬁêﬁ∞ﬁâﬁ®ﬁÇﬁ∞';
                else return;

                // Using Faruma for heading text
                line += `<span style="font-family: 'Faruma'; font-weight: bold; color: ${color}; margin-left: 5px;">${dvHeadingText}</span> ${contentText}`;
            }
            
            line += `</p>`;
        }
        
        container.innerHTML = line;
    }

    // Main function to update the post preview
    function updatePost() {
        const dateInput = document.getElementById('date-input').value;
        const timeInput = document.getElementById('time-select').value;
        const period = document.getElementById('forecast-period').value;

        // 1. Dynamic Titles
        let enHeader, dvHeader;
        if (period === 'today') {
            enHeader = "TODAY'S WEATHER";
            dvHeader = "ﬁâﬁ®ﬁáﬁ¶ﬁãﬁ™ﬁéﬁ¨ ﬁâﬁ´ﬁêﬁ™ﬁÇﬁ∞";
        } else {
            enHeader = "TONIGHT'S WEATHER";
            dvHeader = "ﬁâﬁ®ﬁÉﬁ≠ﬁéﬁ¨ ﬁâﬁ´ﬁêﬁ™ﬁÇﬁ∞";
        }

        // 2. Dynamic Time/Date Formatting
        const dateParts = dateInput.split('-');
        const date = new Date(dateParts[0], dateParts[1] - 1, dateParts[2]);
        const day = date.getDate();
        const monthIndex = date.getMonth();
        const monthEn = getMonthName(monthIndex);
        const monthDv = getDhivehiMonthName(monthIndex);
        const year = date.getFullYear();
        const time = timeInput.replace(':', ''); 
        const suffix = getDaySuffix(day);

        // English Date Format
        const forecastDateEn = `Valid until ${time} hrs, ${day}${suffix} ${monthEn} ${year}`;
        
        // Dhivehi Date Format (Year first, as requested)
        const forecastDateDv = `${year} ${monthDv} ${day} ﬁàﬁ¶ﬁÇﬁ¶ ﬁãﬁ™ﬁàﬁ¶ﬁÄﬁ™ﬁéﬁ¨ ${time} ﬁáﬁß ﬁÄﬁ¶ﬁâﬁ¶ﬁáﬁ¶ﬁÅﬁ∞`;
        
        // 3. Update the new header fields
        document.getElementById('dv-header-title').textContent = dvHeader;
        document.getElementById('dv-header-date').textContent = forecastDateDv;
        document.getElementById('en-header-title').textContent = enHeader;
        document.getElementById('en-header-date').textContent = forecastDateEn;

        // 4. Update Advisory Fields (Conditional visibility is handled inside updateForecastItem)
        updateForecastItem('en', 'adv', 'ADVISORY', document.getElementById('adv-en').value);
        updateForecastItem('dv', 'adv', 'ﬁáﬁ®ﬁÉﬁ™ﬁùﬁßﬁãﬁ™', document.getElementById('adv-dv').value);

        // 5. Update Forecast Content Fields (Standard visibility)
        updateForecastItem('en', 'wx', 'WEATHER', document.getElementById('wx-en').value);
        updateForecastItem('en', 'wind', 'WIND', document.getElementById('wind-en').value);
        updateForecastItem('en', 'sea', 'SEA', document.getElementById('sea-en').value);
        updateForecastItem('en', 'wave', 'WAVE HEIGHT', document.getElementById('wave-en').value);

        updateForecastItem('dv', 'wx', 'ﬁâﬁ´ﬁêﬁ™ﬁÇﬁ∞', document.getElementById('wx-dv').value);
        updateForecastItem('dv', 'wind', 'ﬁàﬁ¶ﬁáﬁ®', document.getElementById('wind-dv').value);
        updateForecastItem('dv', 'sea', 'ﬁÜﬁ¶ﬁÇﬁëﬁ™ﬁéﬁ¨ ﬁôﬁßﬁçﬁ¶ﬁåﬁ™', document.getElementById('sea-dv').value);
        updateForecastItem('dv', 'wave', 'ﬁÉﬁßﬁÖﬁ™ﬁéﬁ¨ ﬁáﬁ™ﬁêﬁ∞ﬁâﬁ®ﬁÇﬁ∞', document.getElementById('wave-dv').value);
    }

    // Function to populate the time dropdown (00:00 to 23:00)
    function populateTimeSelect() {
        const select = document.getElementById('time-select');
        for (let h = 0; h < 24; h++) {
            const hour = String(h).padStart(2, '0');
            const time = `${hour}:00`;
            const option = document.createElement('option');
            option.value = time;
            option.textContent = time;
            select.appendChild(option);
        }
        // Set default value 
        select.value = "18:00"; 
    }

    /**
     * Download function configured to work with local images by setting allowTaint: true.
     * **You MUST run this file via a local web server for this to work.**
     */
    function downloadPost() {
        const element = document.getElementById('weather-post');

        html2canvas(element, { 
            scale: 2, 
            useCORS: true,
            allowTaint: true, 
            logging: false, 
            imageTimeout: 15000 
        }).then(canvas => {
            const link = document.createElement('a');
            link.download = `Maldives_Forecast_${document.getElementById('date-input').value.replace(/-/g, '_')}_${document.getElementById('time-select').value.replace(':', '')}.png`;
            link.href = canvas.toDataURL('image/png');
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }).catch(err => {
            console.error("Image generation failed:", err);
            // CRITICAL WARNING for the user
            alert("‚ùå Download Failed! The image could not be created.\n\n*** TROUBLESHOOTING STEP: ***\n1. Ensure all image/font files (maldives_map.png, maldives_logo.png, emblem.png, Faruma.ttf, Mvlhohi bold.ttf) are in the SAME FOLDER.\n2. You MUST run this HTML file using a local web server (e.g., VS Code's 'Live Server' extension, or by running 'python -m http.server' in your terminal). Running it directly from your file system (file:///) will block the download.");
        });
    }

    // Initialization function called on body load
    function initializeEditor() {
        populateTimeSelect();
        // Set default date to the current date in Maldives (UTC+5)
        const now = new Date(new Date().toLocaleString("en-US", {timeZone: "Indian/Maldives"}));
        const today = now.toISOString().split('T')[0];
        document.getElementById('date-input').value = today;
        
        // Initial update
        updatePost();
    }
</script>
</body>
</html>